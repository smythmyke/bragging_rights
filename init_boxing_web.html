<!DOCTYPE html>
<html>
<head>
    <title>Initialize Boxing Collections</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        h1 { color: #4ade80; }
        .status {
            padding: 10px;
            margin: 10px 0;
            background: #333;
            border-radius: 5px;
            border-left: 3px solid #4ade80;
        }
        .error { border-left-color: #f87171; }
        button {
            background: #4ade80;
            color: #000;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover { background: #22c55e; }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        #output {
            background: #000;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            font-family: monospace;
            white-space: pre-line;
        }
    </style>
</head>
<body>
    <h1>ü•ä Boxing Collections Initializer</h1>

    <div class="status">
        This will initialize the Firestore collections for the Boxing feature.
    </div>

    <button id="initBtn" onclick="initializeCollections()">Initialize Boxing Collections</button>

    <div id="output"></div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import {
            getFirestore,
            doc,
            setDoc,
            collection,
            addDoc,
            serverTimestamp
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCAK38Cbn7xPxjWMhSqiWDmJ0N4oqULfQk",
            authDomain: "bragging-rights-ea6e1.firebaseapp.com",
            projectId: "bragging-rights-ea6e1",
            storageBucket: "bragging-rights-ea6e1.appspot.com",
            messagingSenderId: "685843104433",
            appId: "1:685843104433:web:19b65f6f14c7e0f06ffb68"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.initializeCollections = async function() {
            const output = document.getElementById('output');
            const btn = document.getElementById('initBtn');
            btn.disabled = true;
            output.innerHTML = 'Starting initialization...\n\n';

            try {
                // 1. Initialize metadata
                output.innerHTML += '1. Creating boxing_cache/metadata document...\n';
                await setDoc(doc(db, 'boxing_cache', 'metadata'), {
                    apiCallsThisMonth: 0,
                    apiCallsRemaining: 100,
                    lastUpdated: null,
                    nextScheduledUpdate: new Date(Date.now() + 24 * 60 * 60 * 1000),
                    monthStarted: serverTimestamp(),
                    cacheVersion: '1.0',
                    initialized: serverTimestamp(),
                    description: 'Boxing Data API cache metadata'
                });
                output.innerHTML += '   ‚úÖ Metadata document created\n\n';

                // 2. Create sample boxing_events structure
                output.innerHTML += '2. Creating boxing_events collection structure...\n';
                await setDoc(doc(db, 'boxing_events', '_sample_structure'), {
                    _sample: true,
                    _description: 'Sample structure - will be replaced by real data',
                    title: 'Sample Event',
                    date: new Date(),
                    venue: 'Sample Venue',
                    location: 'Sample Location',
                    posterUrl: null,
                    promotion: 'Sample Promotion',
                    broadcasters: ['Sample Network'],
                    source: 'boxing_data',
                    hasFullData: true,
                    lastUpdated: serverTimestamp()
                });
                output.innerHTML += '   ‚úÖ boxing_events collection initialized\n\n';

                // 3. Create sample boxing_fights structure
                output.innerHTML += '3. Creating boxing_fights collection structure...\n';
                await setDoc(doc(db, 'boxing_fights', '_sample_structure'), {
                    _sample: true,
                    _description: 'Sample structure - will be replaced by real data',
                    title: 'Fighter A vs Fighter B',
                    eventId: 'sample_event_id',
                    fighters: {
                        fighter_1: {
                            fighter_id: 'sample_1',
                            name: 'Fighter A',
                            full_name: 'Fighter A Name'
                        },
                        fighter_2: {
                            fighter_id: 'sample_2',
                            name: 'Fighter B',
                            full_name: 'Fighter B Name'
                        }
                    },
                    division: 'Welterweight',
                    scheduled_rounds: 12,
                    titles: [],
                    cardPosition: 1,
                    status: 'upcoming',
                    lastUpdated: serverTimestamp()
                });
                output.innerHTML += '   ‚úÖ boxing_fights collection initialized\n\n';

                // 4. Create sample boxing_fighters structure
                output.innerHTML += '4. Creating boxing_fighters collection structure...\n';
                await setDoc(doc(db, 'boxing_fighters', '_sample_structure'), {
                    _sample: true,
                    _description: 'Sample structure - will be replaced by real data',
                    name: 'Sample Fighter',
                    nationality: 'United States',
                    stats: {
                        wins: 0,
                        losses: 0,
                        draws: 0,
                        ko_wins: 0,
                        total_bouts: 0
                    },
                    height: "5' 10\"",
                    reach: "70\"",
                    stance: 'Orthodox',
                    division: 'Welterweight',
                    titles: [],
                    source: 'boxing_data',
                    updatePriority: 3,
                    lastUpdated: serverTimestamp()
                });
                output.innerHTML += '   ‚úÖ boxing_fighters collection initialized\n\n';

                // 5. Create activity log
                output.innerHTML += '5. Creating boxing_activity_log collection...\n';
                await addDoc(collection(db, 'boxing_activity_log'), {
                    status: 'initialized',
                    message: 'Boxing collections initialized via web',
                    timestamp: serverTimestamp()
                });
                output.innerHTML += '   ‚úÖ boxing_activity_log collection created\n\n';

                // 6. Create errors collection
                output.innerHTML += '6. Creating boxing_errors collection...\n';
                await addDoc(collection(db, 'boxing_errors'), {
                    service: 'initialization',
                    error: 'No errors - initialization successful',
                    timestamp: serverTimestamp()
                });
                output.innerHTML += '   ‚úÖ boxing_errors collection created\n\n';

                output.innerHTML += 'üéâ SUCCESS! All Boxing collections initialized!\n\n';
                output.innerHTML += 'Next steps:\n';
                output.innerHTML += '‚Ä¢ The dailyBoxingUpdate function will run at 3 AM EST\n';
                output.innerHTML += '‚Ä¢ To trigger immediate update: Firebase Console > Functions > dailyBoxingUpdate > Run\n';
                output.innerHTML += '‚Ä¢ Monitor API usage in Firestore > boxing_cache > metadata\n';
                output.innerHTML += '‚Ä¢ Check boxing_activity_log for update history\n';

            } catch (error) {
                output.innerHTML += '\n‚ùå Error: ' + error.message + '\n';
                console.error('Error:', error);
            }

            btn.disabled = false;
            btn.textContent = 'Re-initialize Collections';
        }
    </script>
</body>
</html>